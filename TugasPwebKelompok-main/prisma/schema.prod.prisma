generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Station {
  id          Int    @id @default(autoincrement())
  code        String @unique
  name        String
  city        String
  stationType String // "Intercity" | "KRL" | "Both"

  routes             RouteStop[]
  departureSchedules Schedule[]  @relation("ScheduleDeparture")
  arrivalSchedules   Schedule[]  @relation("ScheduleArrival")

  favoriteOriginRoutes      FavoriteRoute[] @relation("FavOrigin")
  favoriteDestinationRoutes FavoriteRoute[] @relation("FavDest")
  historyOriginRoutes       SearchHistory[] @relation("HistoryOrigin")
  historyDestinationRoutes  SearchHistory[] @relation("HistoryDest")
}

model Train {
  id        Int    @id @default(autoincrement())
  name      String
  trainType String // "Intercity" | "KRL"

  classes    TrainClass[]
  routeStops RouteStop[]
  schedules  Schedule[]
}

model TrainClass {
  id        Int    @id @default(autoincrement())
  className String // "Eksekutif" | "Bisnis" | "Ekonomi"
  price     Int

  train   Train @relation(fields: [trainId], references: [id])
  trainId Int
}

model RouteStop {
  id        Int @id @default(autoincrement())
  stopOrder Int

  train   Train @relation(fields: [trainId], references: [id])
  trainId Int

  station   Station @relation(fields: [stationId], references: [id])
  stationId Int

  arrivalTime   DateTime?
  departureTime DateTime?
}

model Schedule {
  id            Int      @id @default(autoincrement())
  departureTime DateTime
  arrivalTime   DateTime

  train   Train @relation(fields: [trainId], references: [id])
  trainId Int

  departureStation   Station @relation("ScheduleDeparture", fields: [departureStationId], references: [id])
  departureStationId Int

  arrivalStation   Station @relation("ScheduleArrival", fields: [arrivalStationId], references: [id])
  arrivalStationId Int

  bookings Booking[]
}

model FavoriteRoute {
  id                   Int    @id @default(autoincrement())
  userId               String
  originStationId      Int
  destinationStationId Int

  origin      Station @relation("FavOrigin", fields: [originStationId], references: [id])
  destination Station @relation("FavDest", fields: [destinationStationId], references: [id])
}

model SearchHistory {
  id                   Int      @id @default(autoincrement())
  userId               String
  searchDate           DateTime @default(now())
  originStationId      Int
  destinationStationId Int

  origin      Station @relation("HistoryOrigin", fields: [originStationId], references: [id])
  destination Station @relation("HistoryDest", fields: [destinationStationId], references: [id])
}

model Booking {
  id         Int      @id @default(autoincrement())
  userId     String
  scheduleId Int
  className  String   // "Eksekutif" | "Bisnis" | "Ekonomi"
  totalPrice Int
  status     String   @default("PENDING") // "PENDING" | "PAID" | "CANCELLED"
  createdAt  DateTime @default(now())

  schedule Schedule @relation(fields: [scheduleId], references: [id])
  payment  Payment?
}

model Payment {
  id         Int      @id @default(autoincrement())
  bookingId  Int      @unique
  method     String   // QRIS, Transfer, VA, dll
  paidAmount Int
  paidAt     DateTime @default(now())

  booking Booking @relation(fields: [bookingId], references: [id])
}
